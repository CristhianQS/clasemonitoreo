<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel Facultades UPeU</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8f0f7 0%, #f5f8fb 100%);
            color: #2c3e50;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 25px 70px rgba(0, 56, 101, 0.15);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #003865 0%, #005a9e 50%, #0077cc 100%);
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="40" fill="rgba(255,255,255,0.03)"/></svg>');
            background-size: 100px 100px;
            opacity: 0.5;
        }

        h1 {
            color: white;
            font-size: 36px;
            font-weight: 700;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .subtitle {
            color: rgba(255,255,255,0.95);
            font-size: 15px;
            margin-top: 10px;
            position: relative;
            z-index: 1;
            font-weight: 500;
        }

        .button-bar {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 35px 0;
            padding: 0 20px;
        }

        .faculty-btn {
            background: linear-gradient(135deg, #003865 0%, #004d8c 100%);
            color: white;
            padding: 14px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 56, 101, 0.2);
            position: relative;
            overflow: hidden;
        }

        .faculty-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .faculty-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .faculty-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 56, 101, 0.3);
        }

        .faculty-btn.active {
            background: linear-gradient(135deg, #0077cc 0%, #0099ff 100%);
            box-shadow: 0 6px 20px rgba(0, 119, 204, 0.4);
        }

        .content-section {
            padding: 40px 30px;
            min-height: 450px;
        }

        .faculty-title {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 15px;
            border-bottom: 4px solid transparent;
            background: linear-gradient(to right, transparent, #003865 50%, transparent) bottom;
            background-size: 100% 4px;
            background-repeat: no-repeat;
        }

        .faculty-title h2 {
            font-size: 28px;
            color: #003865;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .chart-box {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            overflow: hidden;
            border: 2px solid #f0f4f8;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .chart-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--chart-color);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chart-box:hover::before {
            transform: scaleX(1);
        }

        .chart-box:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
            border-color: var(--chart-color);
        }

        .chart-header {
            background: linear-gradient(135deg, var(--chart-color-dark) 0%, var(--chart-color) 100%);
            padding: 18px 24px;
        }

        .chart-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .chart-content {
            padding: 25px;
            background: linear-gradient(to bottom, #fafbfc 0%, white 100%);
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .chart-image-container {
            flex: 1;
            min-width: 0;
            height: 220px;
            background: white;
            border: 2px solid #f0f4f8;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .chart-canvas {
            max-width: 100%;
            max-height: 100%;
        }

        .chart-value-display {
            flex: 0 0 145px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            border: 4px solid var(--chart-color);
            border-radius: 18px;
            padding: 25px 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            min-height: 190px;
            position: relative;
            overflow: hidden;
        }

        .chart-value-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 50%, var(--chart-color-light) 0%, transparent 70%);
            opacity: 0.15;
        }

        .chart-value-number {
            font-size: 52px;
            font-weight: 800;
            color: var(--chart-color);
            line-height: 1;
            position: relative;
            z-index: 1;
        }

        .chart-value-label {
            font-size: 11px;
            color: #6c757d;
            margin-top: 14px;
            text-transform: uppercase;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 1;
        }

        footer {
            text-align: center;
            padding: 25px;
            background: linear-gradient(to top, #f8f9fa 0%, white 100%);
            color: #6c757d;
            font-size: 13px;
            border-top: 2px solid #e9ecef;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .chart-content {
                flex-direction: column;
            }
            
            .chart-image-container {
                flex: 0 0 auto;
                width: 100%;
            }

            .chart-value-display {
                flex: 0 0 auto;
                width: 100%;
            }

            h1 {
                font-size: 28px;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chart-box {
            animation: fadeIn 0.6s ease-out backwards;
        }

        .chart-box:nth-child(1) { animation-delay: 0.1s; }
        .chart-box:nth-child(2) { animation-delay: 0.2s; }
        .chart-box:nth-child(3) { animation-delay: 0.3s; }
        .chart-box:nth-child(4) { animation-delay: 0.4s; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Clases BÃ­blicas UPeU Juliaca</h1>
            <div class="subtitle">Sistema de Monitoreo en Tiempo Real</div>
        </header>

        <div class="button-bar">
            <button class="faculty-btn active" onclick="mostrarFacultad('INICIO', event)">INICIO</button>
            <button class="faculty-btn" onclick="mostrarFacultad('FIA', event)">FIA</button>
            <button class="faculty-btn" onclick="mostrarFacultad('FCE', event)">FCE</button>
            <button class="faculty-btn" onclick="mostrarFacultad('FACIHED', event)">FACIHED</button>
            <button class="faculty-btn" onclick="mostrarFacultad('FCS', event)">FCS</button>
        </div>

        <section class="content-section">
            <div class="faculty-title"><h2 id="faculty-title">Vista General de las facultades</h2></div>
            <div class="chart-grid" id="grid"></div>
        </section>

        <footer><p>Sistema de VisualizaciÃ³n Clases Biblicas | Asuntos Academicos Â© 2025</p></footer>
    </div>

    <script>
        // ============================================
        // CONFIGURACIÃN GENERAL
        // ============================================
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQiFXjYjAygAByVbJwIoP2gY9mdjr-_tsknfT37ki2XLs20pZ6nV1-tXeivgO5wN9ndhvsYjobjh7fU/pub?gid=1727939500&single=true&output=csv';
        const TEXTO_TOTAL = "Total Participantes";

        // ============================================
        // ESCUELAS (INICIO)
        // ============================================
        const escuelasInicio = [
            { filaNombre: 24, filaValor: 2 },
            { filaNombre: 25, filaValor: 3 },
            { filaNombre: 26, filaValor: 4 },
            { filaNombre: 27, filaValor: 5 },
            { filaNombre: 28, filaValor: 6 },
            { filaNombre: 29, filaValor: 7 },
            { filaNombre: 30, filaValor: 8 },
            { filaNombre: 31, filaValor: 9 },
            { filaNombre: 32, filaValor: 10 },
            { filaNombre: 33, filaValor: 11 },
            { filaNombre: 34, filaValor: 12 },
            { filaNombre: 35, filaValor: 13 },
            { filaNombre: 36, filaValor: 14 },
            { filaNombre: 37, filaValor: 15 },
            { filaNombre: 38, filaValor: 16 },
            { filaNombre: 39, filaValor: 17 },
            { filaNombre: 40, filaValor: 18 },
            { filaNombre: 41, filaValor: 19 },
            { filaNombre: 42, filaValor: 20 },
            { filaNombre: 43, filaValor: 21 },
            { filaNombre: 44, filaValor: 22 }
        ];

        // ============================================
        // FACULTAD DE INGENIERÃA Y ARQUITECTURA (FIA)
        // ============================================
        const escuelasFIA = [
            { filaNombre: 24, filaValor: 2 },
            { filaNombre: 25, filaValor: 3 },
            { filaNombre: 30, filaValor: 8 },
            { filaNombre: 29, filaValor: 7 }
        ];

        // ============================================
        // FACULTAD DE CIENCIAS EMPRESARIALES (FCE)
        // ============================================
        const escuelasFCE = [
            { filaNombre: 26, filaValor: 4 },
            { filaNombre: 31, filaValor: 9 },
            { filaNombre: 32, filaValor: 10 }
        ];

        // ============================================
        // FACULTAD CIENCIAS HUMANAS, EDUCACIÃN Y DERECHO (FACIHED)
        // ============================================
        const escuelasFACIHED = [
            { filaNombre: 27, filaValor: 5 },
            { filaNombre: 28, filaValor: 6 }
        ];

        // ============================================
        // FACULTAD DE CIENCIAS DE LA SALUD (FCS)
        // ============================================
        const escuelasFCS = [
            { filaNombre: 33, filaValor: 11 }
        ];

        // ============================================
        // DOCENTES (77-130)
        // ============================================
        const docentesConfig = [
            { filaNombre: 77, filaValor: 2 },
            { filaNombre: 78, filaValor: 3 },
            { filaNombre: 79, filaValor: 4 },
            { filaNombre: 80, filaValor: 5 },
            { filaNombre: 81, filaValor: 6 },
            { filaNombre: 82, filaValor: 7 },
            { filaNombre: 83, filaValor: 8 },
            { filaNombre: 84, filaValor: 9 },
            { filaNombre: 85, filaValor: 10 },
            { filaNombre: 86, filaValor: 11 },
            { filaNombre: 87, filaValor: 12 },
            { filaNombre: 88, filaValor: 13 },
            { filaNombre: 89, filaValor: 14 },
            { filaNombre: 90, filaValor: 15 },
            { filaNombre: 91, filaValor: 16 },
            { filaNombre: 92, filaValor: 17 },
            { filaNombre: 93, filaValor: 18 },
            { filaNombre: 94, filaValor: 19 },
            { filaNombre: 95, filaValor: 20 },
            { filaNombre: 96, filaValor: 21 },
            { filaNombre: 97, filaValor: 22 },
            { filaNombre: 98, filaValor: 23 },
            { filaNombre: 99, filaValor: 24 },
            { filaNombre: 100, filaValor: 25 },
            { filaNombre: 101, filaValor: 26 },
            { filaNombre: 102, filaValor: 27 },
            { filaNombre: 103, filaValor: 28 },
            { filaNombre: 104, filaValor: 29 },
            { filaNombre: 105, filaValor: 30 },
            { filaNombre: 106, filaValor: 31 },
            { filaNombre: 107, filaValor: 32 },
            { filaNombre: 108, filaValor: 33 },
            { filaNombre: 109, filaValor: 34 },
            { filaNombre: 110, filaValor: 35 },
            { filaNombre: 111, filaValor: 35 },
            { filaNombre: 112, filaValor: 36 },
            { filaNombre: 113, filaValor: 37 },
            { filaNombre: 114, filaValor: 38 },
            { filaNombre: 115, filaValor: 39 },
            { filaNombre: 116, filaValor: 40 },
            { filaNombre: 117, filaValor: 41 },
            { filaNombre: 118, filaValor: 42 },
            { filaNombre: 119, filaValor: 43 },
            { filaNombre: 120, filaValor: 44 },
            { filaNombre: 121, filaValor: 45 },
            { filaNombre: 122, filaValor: 46 },
            { filaNombre: 123, filaValor: 47 },
            { filaNombre: 124, filaValor: 48 },
            { filaNombre: 125, filaValor: 49 },
            { filaNombre: 126, filaValor: 50 },
            { filaNombre: 127, filaValor: 51 },
            { filaNombre: 128, filaValor: 52 },
            { filaNombre: 129, filaValor: 53 },
            { filaNombre: 130, filaValor: 54 }
        ];

        // ============================================
        // CLASES BÃBLICAS (147-211)
        // ============================================
        const clasesBiblicasRango = { inicio: 149, fin: 211 };

        // ============================================
        // LECCIONES ACTUALES (213-277)
        // ============================================
        const leccionesActualesRango = { inicio: 215, fin: 277 };

        // ============================================
        // FACULTADES (279-283) y CANTIDADES (286-289)
        // ============================================
        const facultadesConfig = [
            { filaNombre: 281, filaValor: 288 },
            { filaNombre: 282, filaValor: 289 },
            { filaNombre: 283, filaValor: 290 },
            { filaNombre: 284, filaValor: 291 }
        ];

        // ============================================
        // COLORES
        // ============================================
        const colorSchemes = [
            {
                primary: 'rgba(0, 56, 101, 0.85)',
                secondary: 'rgba(0, 119, 204, 0.2)',
                border: 'rgba(0, 56, 101, 1)',
                dark: '#002d4d',
                light: 'rgba(0, 119, 204, 0.15)'
            },
            {
                primary: 'rgba(16, 124, 16, 0.85)',
                secondary: 'rgba(76, 175, 80, 0.2)',
                border: 'rgba(16, 124, 16, 1)',
                dark: '#0a5f0a',
                light: 'rgba(76, 175, 80, 0.15)'
            },
            {
                primary: 'rgba(156, 39, 176, 0.85)',
                secondary: 'rgba(186, 104, 200, 0.2)',
                border: 'rgba(156, 39, 176, 1)',
                dark: '#7b1fa2',
                light: 'rgba(186, 104, 200, 0.15)'
            },
            {
                primary: 'rgba(230, 74, 25, 0.85)',
                secondary: 'rgba(255, 112, 67, 0.2)',
                border: 'rgba(230, 74, 25, 1)',
                dark: '#d84315',
                light: 'rgba(255, 112, 67, 0.15)'
            },
            {
                primary: 'rgba(0, 121, 107, 0.85)',
                secondary: 'rgba(38, 166, 154, 0.2)',
                border: 'rgba(0, 121, 107, 1)',
                dark: '#00695c',
                light: 'rgba(38, 166, 154, 0.15)'
            },
            {
                primary: 'rgba(245, 124, 0, 0.85)',
                secondary: 'rgba(255, 152, 0, 0.2)',
                border: 'rgba(245, 124, 0, 1)',
                dark: '#e65100',
                light: 'rgba(255, 152, 0, 0.15)'
            },
            {
                primary: 'rgba(21, 101, 192, 0.85)',
                secondary: 'rgba(66, 165, 245, 0.2)',
                border: 'rgba(21, 101, 192, 1)',
                dark: '#0d47a1',
                light: 'rgba(66, 165, 245, 0.15)'
            },
            {
                primary: 'rgba(194, 24, 91, 0.85)',
                secondary: 'rgba(236, 64, 122, 0.2)',
                border: 'rgba(194, 24, 91, 1)',
                dark: '#ad1457',
                light: 'rgba(236, 64, 122, 0.15)'
            }
        ];

        // ============================================
        // ESTRUCTURA DE FACULTADES
        // ============================================
        const facultades = {
            INICIO: {
                nombre: "Asistentes por escuelas",
                escuelas: escuelasInicio
            },
            FIA: {
                nombre: "Facultad de IngenierÃ­a y Arquitectura",
                escuelas: escuelasFIA
            },
            FCE: {
                nombre: "Facultad de Ciencias Empresariales",
                escuelas: escuelasFCE
            },
            FACIHED: {
                nombre: "Facultad de Ciencias Humanas, EducaciÃ³n y Derecho",
                escuelas: escuelasFACIHED
            },
            FCS: {
                nombre: "Facultad de Ciencias de la Salud",
                escuelas: escuelasFCS
            }
        };

        // ============================================
        // FUNCIONES AUXILIARES
        // ============================================

        function obtenerDocentes(dataCache) {
            const docentes = [];
            
            docentesConfig.forEach(config => {
                const nombre = dataCache[config.filaNombre - 1] && dataCache[config.filaNombre - 1][0]
                    ? dataCache[config.filaNombre - 1][0].trim()
                    : '';
                
                if (nombre && nombre !== '') {
                    docentes.push({ nombre: nombre });
                }
            });
            
            return docentes;
        }

        function obtenerClasesBiblicas(dataCache) {
            const clases = [];
            for (let i = clasesBiblicasRango.inicio; i <= clasesBiblicasRango.fin; i++) {
                if (dataCache[i - 1] && dataCache[i - 1][0]) {
                    clases.push(dataCache[i - 1][0].trim());
                }
            }
            return clases;
        }

        function obtenerLecciones(dataCache) {
            const lecciones = [];
            for (let i = leccionesActualesRango.inicio; i <= leccionesActualesRango.fin; i++) {
                if (dataCache[i - 1] && dataCache[i - 1][0]) {
                    lecciones.push(dataCache[i - 1][0].trim());
                }
            }
            return lecciones;
        }

        function obtenerFacultades(dataCache) {
            const facultades = [];
            
            facultadesConfig.forEach(config => {
                const nombre = dataCache[config.filaNombre - 1] && dataCache[config.filaNombre - 1][0]
                    ? dataCache[config.filaNombre - 1][0].trim()
                    : '';
                
                const cantidad = dataCache[config.filaValor - 1] && dataCache[config.filaValor - 1][0]
                    ? dataCache[config.filaValor - 1][0].trim()
                    : '0';
                
                if (nombre && nombre !== '') {
                    facultades.push({
                        nombre: nombre,
                        cantidad: cantidad,
                        valor: parseFloat(cantidad) || 0
                    });
                }
            });
            
            return facultades;
        }

        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let currentFaculty = 'INICIO';
        let dataCache = null;
        let chartInstances = {};

        async function loadData() {
            try {
                const resp = await fetch(SHEET_URL);
                const text = await resp.text();
                const rows = text.trim().split('\n').map(r => r.split(','));
                dataCache = rows;
            } catch (error) {
                console.error('Error al cargar datos:', error);
            }
        }

        function createChart(canvasId, valor, nombre, colorScheme) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            if (chartInstances[canvasId]) {
                chartInstances[canvasId].destroy();
            }

            const numericValue = parseFloat(valor) || 0;
            const max = 300;

            chartInstances[canvasId] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [nombre, 'Restante'],
                    datasets: [{
                        data: [numericValue, Math.max(0, max - numericValue)],
                        backgroundColor: [
                            colorScheme.primary,
                            colorScheme.secondary
                        ],
                        borderColor: [
                            colorScheme.border,
                            'rgba(220, 220, 220, 0.5)'
                        ],
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 13 },
                            callbacks: {
                                label: function(context) {
                                    if (context.dataIndex === 0) {
                                        return 'Valor: ' + context.parsed + ' de ' + max;
                                    }
                                    return null;
                                }
                            }
                        }
                    },
                    cutout: '72%'
                }
            });
        }

        function renderFaculty(facKey) {
            if (!dataCache) {
                console.error('No hay datos cargados');
                return;
            }

            const faculty = facultades[facKey];
            const grid = document.getElementById('grid');
            document.getElementById('faculty-title').textContent = faculty.nombre;
            grid.innerHTML = '';

            Object.keys(chartInstances).forEach(key => {
                if (chartInstances[key]) {
                    chartInstances[key].destroy();
                }
            });
            chartInstances = {};

            const escuelasConDatos = faculty.escuelas.map(esc => {
                const nombre = dataCache[esc.filaNombre - 1] && dataCache[esc.filaNombre - 1][0] 
                    ? dataCache[esc.filaNombre - 1][0].trim() 
                    : 'Sin nombre';
                
                const valor = dataCache[esc.filaValor - 1] && dataCache[esc.filaValor - 1][0]
                    ? dataCache[esc.filaValor - 1][0].trim()
                    : '0';
                
                return {
                    nombre: nombre,
                    valor: valor,
                    filaNombre: esc.filaNombre,
                    filaValor: esc.filaValor
                };
            }).filter(esc => esc.nombre !== 'Sin nombre' && esc.nombre !== '');

            if (facKey === 'INICIO') {
                const canvasId = 'chart-inicio-consolidado';
                const labels = [];
                const valores = [];
                const backgroundColors = [];
                const borderColors = [];
                let totalBautizados = 0;

                escuelasConDatos.forEach((esc, index) => {
                    const valor = parseFloat(esc.valor) || 0;
                    const colorScheme = colorSchemes[index % colorSchemes.length];
                    
                    labels.push(esc.nombre);
                    valores.push(valor);
                    backgroundColors.push(colorScheme.primary);
                    borderColors.push(colorScheme.border);
                    totalBautizados += valor;
                });

                const box = document.createElement('div');
                box.className = 'chart-box';
                box.style.setProperty('--chart-color', '#003865');
                box.style.setProperty('--chart-color-dark', '#002d4d');
                box.style.setProperty('--chart-color-light', 'rgba(0, 119, 204, 0.15)');
                box.style.maxWidth = '100%';
                box.style.margin = '0 auto';
                box.style.gridColumn = '1 / -1';
                
                let legendaHTML = '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; width: 100%;">';
                escuelasConDatos.forEach((esc, index) => {
                    const colorScheme = colorSchemes[index % colorSchemes.length];
                    legendaHTML += `
                        <div style="display: flex; align-items: center; gap: 6px; padding: 8px; background: #f8f9fa; border-radius: 8px;">
                            <div style="width: 16px; height: 16px; background: ${colorScheme.border}; border-radius: 4px; flex-shrink: 0;"></div>
                            <span style="font-size: 11px; color: #2c3e50; font-weight: 500; flex: 1; line-height: 1.3;">${esc.nombre}</span>
                            <span style="font-size: 14px; color: ${colorScheme.border}; font-weight: 700;">${esc.valor}</span>
                        </div>
                    `;
                });
                legendaHTML += '</div>';
                
                box.innerHTML = `
                    <div class="chart-header">
                        <div class="chart-title">Vista General de Alumnos Participantes Por Escuelas</div>
                    </div>
                    <div class="chart-content" style="flex-direction: column; padding: 20px; gap: 20px;">
                        <div style="display: flex; flex-direction: row; gap: 30px;">
                            <div style="flex: 0 0 380px; display: flex; flex-direction: column; gap: 15px;">
                                <div class="chart-image-container" style="height: 380px; width: 100%;">
                                    <canvas id="${canvasId}" class="chart-canvas"></canvas>
                                </div>
                                <div class="chart-value-display" style="width: 100%; flex: 0 0 auto; min-height: 100px;">
                                    <span class="chart-value-number" style="font-size: 56px;">${totalBautizados}</span>
                                    <span class="chart-value-label">${TEXTO_TOTAL}</span>
                                </div>
                            </div>
                            <div style="flex: 1; display: flex; align-items: center;">
                                ${legendaHTML}
                            </div>
                        </div>
                        <div style="width: 100%; border-top: 2px solid #e9ecef; padding-top: 20px; margin-top: 20px;">
                            <h3 style="text-align: center; color: #003865; font-size: 18px; font-weight: 600; margin-bottom: 20px;">Alumnos Bautizados por Facultad</h3>
                            ${(() => {
                                const facultadesData = obtenerFacultades(dataCache);
                                if (facultadesData.length === 0) return '<p>No hay datos de facultades</p>';

                                let legendaFacHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; width: 100%; margin-bottom: 20px;">';
                                facultadesData.forEach((fac, index) => {
                                    const colorScheme = colorSchemes[index % colorSchemes.length];
                                    legendaFacHTML += `
                                        <div style="display: flex; align-items: center; gap: 8px; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                                            <div style="width: 24px; height: 24px; background: ${colorScheme.border}; border-radius: 4px; flex-shrink: 0;"></div>
                                            <span style="font-size: 13px; color: #2c3e50; font-weight: 600; flex: 1;">${fac.nombre}</span>
                                            <span style="font-size: 18px; color: ${colorScheme.border}; font-weight: 800;">${fac.cantidad}</span>
                                        </div>
                                    `;
                                });
                                legendaFacHTML += '</div>';

                                const totalFacultades = facultadesData.reduce((sum, fac) => sum + fac.valor, 0);

                                return legendaFacHTML + `
                                    <div style="display: flex; align-items: center; justify-content: center; padding: 20px; background: linear-gradient(135deg, #f0f4f8 0%, #ffffff 100%); border-radius: 12px; border: 2px solid #003865; width: 100%; max-width: 600px; margin: 0 auto;">
                                        <div style="text-align: center;">
                                            <div style="font-size: 48px; font-weight: 800; color: #003865;">${totalFacultades}</div>
                                            <div style="font-size: 12px; color: #6c757d; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; margin-top: 5px;">Total Alumnos</div>
                                        </div>
                                    </div>
                                `;
                            })()}
                        </div>
                        <div style="width: 100%; border-top: 2px solid #e9ecef; padding-top: 20px; margin-top: 20px;">
                            <h3 style="text-align: center; color: #003865; font-size: 18px; font-weight: 600; margin-bottom: 20px;">Clases BÃ­blicas y Lecciones Actuales</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 12px;">
                                ${(() => {
                                    const clasesBiblicas = obtenerClasesBiblicas(dataCache);
                                    const leccionesActuales = obtenerLecciones(dataCache);
                                    
                                    let html = '';
                                    for (let i = 0; i < clasesBiblicas.length; i++) {
                                        const clase = clasesBiblicas[i];
                                        const leccion = leccionesActuales[i] || '';
                                        
                                        if (clase || leccion) {
                                            html += `
                                                <div style="display: grid; grid-template-columns: 1fr auto; gap: 12px; padding: 12px; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 8px; border-left: 3px solid #0077cc; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                                    <div style="display: flex; align-items: center; gap: 8px;">
                                                        <span style="flex: 0 0 28px; width: 28px; height: 28px; background: linear-gradient(135deg, #0077cc 0%, #0099ff 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700;">${i + 1}</span>
                                                        <span style="font-size: 13px; color: #2c3e50; font-weight: 600; flex: 1;">${clase || 'â'}</span>
                                                    </div>
                                                    <div style="display: flex; align-items: center; padding: 6px 16px; background: linear-gradient(135deg, #003865 0%, #0077cc 100%); border-radius: 20px;">
                                                        <span style="font-size: 12px; color: white; font-weight: 600; white-space: nowrap;">${leccion || 'â'}</span>
                                                    </div>
                                                </div>
                                            `;
                                        }
                                    }
                                    return html;
                                })()}
                            </div>
                        </div>
                        <div style="width: 100%; border-top: 2px solid #e9ecef; padding-top: 20px;">
                            <h3 style="text-align: center; color: #003865; font-size: 18px; font-weight: 600; margin-bottom: 20px;">Docentes Participantes (${(() => obtenerDocentes(dataCache).length)()})</h3>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                                ${(() => {
                                    const docentes = obtenerDocentes(dataCache);
                                    return docentes.map((docente, index) => `
                                        <div style="display: flex; align-items: center; gap: 8px; padding: 10px; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 8px; border-left: 3px solid #003865; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                            <span style="flex: 0 0 28px; width: 28px; height: 28px; background: linear-gradient(135deg, #003865 0%, #0077cc 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700;">${index + 1}</span>
                                            <span style="font-size: 12px; color: #2c3e50; font-weight: 500; flex: 1; line-height: 1.4;">${docente.nombre}</span>
                                        </div>
                                    `).join('');
                                })()}
                            </div>
                        </div>
                    </div>
                `;
                
                grid.appendChild(box);

                setTimeout(() => {
                    const ctx = document.getElementById(canvasId);
                    if (!ctx) return;

                    chartInstances[canvasId] = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: labels,
                            datasets: [{
                                data: valores,
                                backgroundColor: backgroundColors,
                                borderColor: borderColors,
                                borderWidth: 3
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    padding: 12,
                                    titleFont: { size: 14, weight: 'bold' },
                                    bodyFont: { size: 13 },
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.parsed;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = ((value / total) * 100).toFixed(1);
                                            return `${label}: ${value} (${percentage}%)`;
                                        }
                                    }
                                }
                            },
                            cutout: '65%'
                        }
                    });
                }, 50);
            } else {
                escuelasConDatos.forEach((esc, index) => {
                    const canvasId = `chart-${facKey}-${index}`;
                    const colorScheme = colorSchemes[index % colorSchemes.length];
                    
                    const box = document.createElement('div');
                    box.className = 'chart-box';
                    box.style.setProperty('--chart-color', colorScheme.border);
                    box.style.setProperty('--chart-color-dark', colorScheme.dark);
                    box.style.setProperty('--chart-color-light', colorScheme.light);
                    
                    box.innerHTML = `
                        <div class="chart-header">
                            <div class="chart-title">${esc.nombre}</div>
                        </div>
                        <div class="chart-content">
                            <div class="chart-image-container">
                                <canvas id="${canvasId}" class="chart-canvas"></canvas>
                            </div>
                            <div class="chart-value-display">
                                <span class="chart-value-number">${esc.valor}</span>
                            </div>
                        </div>
                    `;
                    
                    grid.appendChild(box);

                    setTimeout(() => createChart(canvasId, esc.valor, esc.nombre, colorScheme), 50);
                });
            }
        }

        function mostrarFacultad(facKey, event) {
            document.querySelectorAll('.faculty-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            currentFaculty = facKey;
            renderFaculty(facKey);
        }

        async function init() {
            await loadData();
            renderFaculty('INICIO');
            setInterval(async () => {
                await loadData();
                renderFaculty(currentFaculty);
            }, 60000);
        }

        window.onload = init;
    </script>
</body>
</html>
